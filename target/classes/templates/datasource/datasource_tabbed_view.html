<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${datasourceName + ' - Dashboard'}">Dashboard</title>
    <link rel="icon" type="image/x-icon" th:href="@{/favicon.ico}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.css" rel="stylesheet" />
    <link href="/datasource/datasource_tabbed_view.css" rel="stylesheet">
    <script src="/datasource/datasource_tabbed_view.js"></script>
</head>
<body>
    <div class="container-fluid" style="height:100vh;min-height:100vh;">
        <div class="row" style="height:100vh;min-height:100vh;">
            <!-- Sidebar with header and icons -->
            <div class="col-md-1 sidebar p-0">
                <div class="sidebar-header">
                    <div class="datasource-name">HG</div>
                    <a class="logout-link" th:href="@{/hypergeneric/{name}/logout(name=${datasourceName})}">Logout</a>
                </div>
                <div class="flex-grow-1 d-flex flex-column align-items-center justify-content-start pt-3 w-100">
                    <div th:each="tab : ${tabs}" class="position-relative w-100 d-flex flex-column align-items-center">
                        <a th:class="'sidebar-icon nav-link mb-1 ' + (${tab == activeTab ? 'active' : ''})"
                           th:href="@{/hypergeneric/{name}/tab/{tab}(name=${datasourceName},tab=${tab})}"
                           th:switch="${tab}">
                            <i th:case="'dashboard'" class="fas fa-tachometer-alt"></i>
                            <i th:case="'navigator'" class="fas fa-compass"></i>
                            <i th:case="'search'" class="fas fa-search"></i>
                            <i th:case="'creation'" class="fas fa-plus-square"></i>
                            <i th:case="'utilities'" class="fas fa-tools"></i>
                            <i th:case="'profile'" class="fas fa-user"></i>
                            <i th:case="'map'" class="fas fa-ship"></i>
                            <!-- New Main Tab Icon -->
                            <i th:case="'customtab'" class="fas fa-window-maximize"></i>
                        </a>
                        <span class="sidebar-tooltip" th:text="${#strings.capitalize(tab)}"></span>
                    </div>
                </div>
            </div>
            <div class="col-md-11 d-flex" style="height:100vh;min-height:100vh;">
                <!-- Main Content Area (Left) -->
                <div class="flex-grow-1" style="min-width:0;">
                    <div id="dynamic-tab-panels" style="width:100%;"></div>
                    <!-- Dashboard Tab -->
                    <div th:if="${activeTab == 'dashboard'}" class="tab-content">
                        <h2>Dashboard</h2>
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-body">
                                        <h5 class="card-title">Overview</h5>
                                        <p class="card-text">Welcome to your database dashboard.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Navigator Tab -->
                    <div th:if="${activeTab == 'navigator'}" class="tab-content">
                        <h2>Navigator</h2>
                        <!-- Add navigator content -->
                    </div>

                    <!-- Search Tab -->
                    <div th:if="${activeTab == 'search'}" class="tab-content">
                        <h2>Search</h2>
                        <!-- Add search content -->
                    </div>

                    <!-- Creation Tab -->
                    <div th:if="${activeTab == 'creation'}" class="tab-content">
                        <h2>Creation</h2>
                        <!-- Add creation content -->
                    </div>

                    <!-- Utilities Tab -->
                    <div th:if="${activeTab == 'utilities'}" class="tab-content p-3 utilities-content">
                        <h2 class="mb-3">Utilities & Configuration</h2>

                        <!-- Horizontal Section Container -->
                        <div class="section-container d-flex flex-wrap justify-content-between">
                            <!-- User Management Section -->
                            <div class="section-box" style="min-height:340px;">
                                <div class="section-header">
                                    <div class="d-flex justify-content-between align-items-center p-3">
                                        <h5 class="mb-0">User Management</h5>
                                    </div>
                                </div>
                                <div class="config-items" style="display:block;max-height:none;">
                                    <div class="config-item">
                                        <i class="fas fa-users"></i> <span>User Accounts</span>
                                    </div>
                                    <div class="config-item">
                                        <i class="fas fa-user-plus"></i> <span>Add User</span>
                                    </div>
                                    <div class="config-item">
                                        <i class="fas fa-user-minus"></i> <span>Remove User</span>
                                    </div>
                                    <div class="config-item">
                                        <i class="fas fa-user-shield"></i> <span>Permissions</span>
                                    </div>
                                    <div class="config-item">
                                        <i class="fas fa-eye"></i> <span>View Permissions</span>
                                    </div>
                                    <div class="config-item">
                                        <i class="fas fa-edit"></i> <span>Edit Permissions</span>
                                    </div>
                                    <div class="config-item">
                                        <i class="fas fa-user-tag"></i> <span>Roles</span>
                                    </div>
                                    <div class="config-item">
                                        <i class="fas fa-list"></i> <span>Role List</span>
                                    </div>
                                    <div class="config-item">
                                        <i class="fas fa-user-check"></i> <span>Assign Role</span>
                                    </div>
                                    <div class="config-item">
                                        <i class="fas fa-user-clock"></i> <span>Activity Log</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Analytics & Navigation Section -->
                            <div class="section-box" style="min-height:340px;">
                                <div class="section-header">
                                    <div class="d-flex justify-content-between align-items-center p-3">
                                        <h5 class="mb-0">Analytics & Navigation</h5>
                                    </div>
                                </div>
                                <div class="config-items" style="display:block;max-height:none;">
                                    <div class="config-item">
                                        <i class="fas fa-chart-line"></i> <span>Usage Statistics</span>
                                    </div>
                                    <div class="config-item">
                                        <i class="fas fa-compass"></i> <span>Navigation Settings</span>
                                    </div>
                                    <div class="config-item">
                                        <i class="fas fa-map-marked-alt"></i> <span>Map Configuration</span>
                                    </div>
                                    <div class="config-item">
                                        <i class="fas fa-chart-pie"></i> <span>Report Builder</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Blueprint and Metadata Section -->
                            <div class="section-box" style="min-height:340px;">
                                <div class="section-header">
                                    <div class="d-flex justify-content-between align-items-center p-3">
                                        <h5 class="mb-0">Blueprint and Metadata</h5>
                                    </div>
                                </div>
                                <div class="config-items" style="display:block;max-height:none;">
                                    <!-- Blueprint Subitem with Plus Button -->
                                    <div class="config-item position-relative blueprint-config-item">
                                        <i class="fas fa-cube"></i> <span>Blueprint</span>
                                        <button class="blueprint-plus-btn" title="Add Blueprint" style="display:none; position:absolute; right:10px; top:50%; transform:translateY(-50%); background:none; border:none; color:#007bff; font-size:1.2rem; cursor:pointer;"><i class="fas fa-plus"></i></button>
                                    </div>
                                    <div class="config-item">
                                        <i class="fas fa-file-import"></i> <span>Import Field</span>
                                    </div>
                                    <div class="config-item">
                                        <i class="fas fa-file-export"></i> <span>Export Field</span>
                                    </div>
                                    <div class="config-item">
                                        <i class="fas fa-project-diagram"></i> <span>Workflow Designer</span>
                                    </div>
                                    <div class="config-item">
                                        <i class="fas fa-user-secret"></i> <span>Confidentiality Levels</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Configuration & Settings Section -->
                            <div class="section-box" style="min-height:340px;">
                                <div class="section-header">
                                    <div class="d-flex justify-content-between align-items-center p-3">
                                        <h5 class="mb-0">Configuration & Settings</h5>
                                    </div>
                                </div>
                                <div class="config-items" style="display:block;max-height:none;">
                                    <div class="config-item">
                                        <i class="fas fa-database"></i> <span>Connection</span>
                                    </div>
                                    <div class="config-item">
                                        <i class="fas fa-database"></i> <span>Backup</span>
                                    </div>
                                    <div class="config-item">
                                        <i class="fas fa-palette"></i> <span>Theme</span>
                                    </div>
                                    <div class="config-item">
                                        <i class="fas fa-palette"></i> <span>Layout</span>
                                    </div>
                                    <div class="config-item">
                                        <i class="fas fa-language"></i> <span>Language</span>
                                    </div>
                                    <div class="config-item">
                                        <i class="fas fa-shield-alt"></i> <span>Password Policy</span>
                                    </div>
                                    <div class="config-item">
                                        <i class="fas fa-shield-alt"></i> <span>2FA</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Reference Tools Section -->
                            <div class="section-box" style="min-height:340px;">
                                <div class="section-header">
                                    <div class="d-flex justify-content-between align-items-center p-3">
                                        <h5 class="mb-0">Reference Tools</h5>
                                    </div>
                                </div>
                                <div class="config-items" style="display:block;max-height:none;">
                                    <div class="config-item">
                                        <i class="fas fa-book"></i> <span>Documentation</span>
                                    </div>
                                    <div class="config-item">
                                        <i class="fas fa-question-circle"></i> <span>Help Center</span>
                                    </div>
                                    <div class="config-item">
                                        <i class="fas fa-info-circle"></i> <span>About</span>
                                    </div>
                                    <div class="config-item">
                                        <i class="fas fa-tools"></i> <span>Developer Tools</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Profile Tab -->
                    <div th:if="${activeTab == 'profile'}" class="tab-content">
                        <h2>Profile</h2>
                        <!-- Add profile content -->
                    </div>

                    <!-- Map Tab -->
                    <div th:if="${activeTab == 'map'}" class="tab-content" style="height:100vh;min-height:100vh;position:relative;overflow:hidden;">
                        <div class="d-flex justify-content-between align-items-start" style="height:calc(100vh - 40px);min-height:calc(100vh - 40px);width:100%;">
                            <div id="map" style="height:calc(100vh - 40px) !important;width:calc(100% - 35px) !important;"></div>
                            <div class="d-flex flex-column align-items-end ms-2" style="min-width:30px;position:absolute;top:10px;right:5px;z-index:10;">
                                <button id="clearMap" class="btn btn-danger btn-sm map-action-btn" style="width:26px;height:26px;min-width:26px;" title="Clear Map"><i class="fas fa-eraser" style="font-size:0.9rem"></i></button>
                                <button id="seaRouteMode" class="btn btn-primary btn-sm map-action-btn" style="width:26px;height:26px;min-width:26px;" title="Create Sea Route"><i class="fas fa-route" style="font-size:0.9rem"></i></button>
                                <button id="saveSeaRoute" class="btn btn-success btn-sm map-action-btn" style="display:none;width:26px;height:26px;min-width:26px;" title="Save Sea Route"><i class="fas fa-save" style="font-size:0.9rem"></i></button>
                                <button id="animateShip" class="btn btn-info btn-sm map-action-btn position-relative" style="width:26px;height:26px;min-width:26px;" title="Animate Ship (VN to US)" disabled>
                                    <span class="spinner-border spinner-border-sm position-absolute d-none" id="animateSpinner" style="top:1px;left:1px;width:24px;height:24px;pointer-events:none;z-index:2;" role="status" aria-hidden="true"></span>
                                    <i class="fas fa-ship position-relative" style="z-index:3;font-size:0.9rem"></i>
                                </button>
                            </div>
                        </div>
                        <div id="mapDebug" class="mt-2 small text-muted" style="height:30px;overflow-y:auto;padding:5px;"></div>
                    </div>

                    <!-- Custom Main Tab -->
                    <div th:if="${activeTab == 'customtab'}" class="tab-content">
                        <h2>Custom Main Tab</h2>
                        <div class="alert alert-info mt-4">This is your new main tab, covering most of the page, similar to Utilities, Creation, and Search tabs.</div>
                        <!-- Add your custom content here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Blueprint Builder Modal/Panel (hidden by default) -->
    <div id="blueprintBuilderPanel" style="display:none; position:fixed; top:0; left:0; width:100vw; height:100vh; background:rgba(0,0,0,0.15); z-index:2000; overflow:auto;">
        <div style="position:relative; margin:40px auto; background:#fff; border-radius:8px; max-width:95vw; min-width:70vw; min-height:80vh; box-shadow:0 4px 32px rgba(0,0,0,0.18);">
            <button id="closeBlueprintBuilder" style="position:absolute; top:10px; right:18px; z-index:10; font-size:1.5rem; background:none; border:none; color:#888; cursor:pointer;">&times;</button>
            <div id="blueprintBuilderContent" style="padding:0; min-height:75vh;"></div>
        </div>
    </div>

    <style>
        .subitem-plus-btn { display: none; }
        .config-subitem:hover .subitem-plus-btn { display: inline-block; }
        .tab-content-panel {
          width: 100%;
          min-height: 100vh;
          background: #eaf8fb;
          padding: 1.5rem 1rem;
          border-radius: 0 0 8px 8px;
          box-shadow: 0 2px 8px rgba(0,0,0,0.04);
          position: relative;
          z-index: 10;
        }
    </style>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Plus button logic for all config subitems
            document.querySelectorAll('.config-subitem').forEach(function(subitem) {
                // Add plus button if not present
                if (!subitem.querySelector('.subitem-plus-btn')) {
                    const btn = document.createElement('button');
                    btn.className = 'subitem-plus-btn';
                    btn.title = 'Open in new tab';
                    btn.style.display = 'none';
                    btn.style.position = 'absolute';
                    btn.style.right = '6px';
                    btn.style.top = '50%';
                    btn.style.transform = 'translateY(-50%)';
                    btn.style.background = 'none';
                    btn.style.border = 'none';
                    btn.style.color = '#007bff';
                    btn.style.fontSize = '1.1rem';
                    btn.style.cursor = 'pointer';
                    btn.style.zIndex = '2';
                    btn.innerHTML = '<i class="fas fa-plus"></i>';
                    subitem.appendChild(btn);
                }
                subitem.addEventListener('mouseenter', function() {
                    const btn = this.querySelector('.subitem-plus-btn');
                    if (btn) btn.style.display = 'inline-block';
                });
                subitem.addEventListener('mouseleave', function() {
                    const btn = this.querySelector('.subitem-plus-btn');
                    if (btn) btn.style.display = 'none';
                });
                subitem.querySelector('.subitem-plus-btn').addEventListener('click', function(e) {
                    e.stopPropagation();
                    const label = subitem.innerText.trim();
                    openSidebarTab(label);
                });
            });

            // Sidebar tab logic: create a new tab with icon/logo and preserve data
            function openSidebarTab(label) {
                // Find the sidebar
                const sidebar = document.querySelector('.sidebar .flex-grow-1');
                if (!sidebar) return;
                // Create a new tab entry
                const tabId = 'customtab-' + Date.now();
                const tabDiv = document.createElement('div');
                tabDiv.className = 'position-relative w-100 d-flex flex-column align-items-center';
                const a = document.createElement('a');
                a.className = 'sidebar-icon nav-link mb-1 active';
                a.href = '#'+tabId;
                a.innerHTML = '<i class="fas fa-star"></i>';
                tabDiv.appendChild(a);
                const tooltip = document.createElement('span');
                tooltip.className = 'sidebar-tooltip';
                tooltip.innerText = label;
                tabDiv.appendChild(tooltip);
                sidebar.appendChild(tabDiv);
                // Deselect other tabs
                document.querySelectorAll('.sidebar-icon').forEach(el => el.classList.remove('active'));
                a.classList.add('active');
                // Show tab content
                let mainContent = document.querySelector('.flex-grow-1');
                if (mainContent) {
                    mainContent.innerHTML = `<div class='tab-content'><h2>${label}</h2><div class='alert alert-info mt-4'>This is a new tab for <b>${label}</b>. Data is preserved here.</div></div>`;
                }
            }
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.14.1/mapbox-gl.js'></script>
    <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.1/mapbox-gl-directions.js'></script>
    <link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.1/mapbox-gl-directions.css' type='text/css' />
    <script src='https://unpkg.com/@turf/turf@6/turf.min.js'></script>
</body>
</html>